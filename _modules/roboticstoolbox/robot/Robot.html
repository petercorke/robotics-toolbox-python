<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>roboticstoolbox.robot.Robot &mdash; Robotics Toolbox for Python  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Robotics Toolbox for Python
            <img src="../../../_static/RobToolBox_RoundLogoB.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../arm.html">Manipulator arms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mobile.html">Mobile robots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../blocks.html">bdsim blocks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Robotics Toolbox for Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">roboticstoolbox.robot.Robot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for roboticstoolbox.robot.Robot</h1><div class="highlight"><pre>
<span></span><span class="c1"># import sys</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span><span class="p">,</span> <span class="n">abstractproperty</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">roboticstoolbox</span> <span class="k">as</span> <span class="nn">rtb</span>
<span class="kn">from</span> <span class="nn">spatialmath</span> <span class="kn">import</span> <span class="n">SE3</span>
<span class="kn">from</span> <span class="nn">spatialmath.base.argcheck</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">isvector</span><span class="p">,</span>
    <span class="n">getvector</span><span class="p">,</span>
    <span class="n">getmatrix</span><span class="p">,</span>
    <span class="n">getunit</span><span class="p">,</span>
    <span class="n">verifymatrix</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">spatialmath.base</span> <span class="k">as</span> <span class="nn">smb</span>
<span class="kn">from</span> <span class="nn">ansitable</span> <span class="kn">import</span> <span class="n">ANSITable</span><span class="p">,</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">roboticstoolbox.backends.PyPlot</span> <span class="kn">import</span> <span class="n">PyPlot</span>
<span class="kn">from</span> <span class="nn">roboticstoolbox.backends.PyPlot.EllipsePlot</span> <span class="kn">import</span> <span class="n">EllipsePlot</span>
<span class="kn">from</span> <span class="nn">roboticstoolbox.robot.Dynamics</span> <span class="kn">import</span> <span class="n">DynamicsMixin</span>
<span class="kn">from</span> <span class="nn">roboticstoolbox.robot.ETS</span> <span class="kn">import</span> <span class="n">ETS</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">spatialgeometry</span> <span class="kn">import</span> <span class="n">Shape</span>
<span class="kn">from</span> <span class="nn">roboticstoolbox.fknm</span> <span class="kn">import</span> <span class="n">Robot_link_T</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">spatialgeometry</span> <span class="kn">import</span> <span class="n">SceneNode</span>
<span class="kn">from</span> <span class="nn">roboticstoolbox.robot.Link</span> <span class="kn">import</span> <span class="n">BaseLink</span><span class="p">,</span> <span class="n">Link</span>

<span class="c1"># from numpy import all, eye, isin</span>
<span class="kn">from</span> <span class="nn">roboticstoolbox.robot.Gripper</span> <span class="kn">import</span> <span class="n">Gripper</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndarray</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

<span class="c1"># import scipy as sp</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

    <span class="n">_mpl</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># pragma nocover</span>
    <span class="k">pass</span>

<span class="n">_default_backend</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">ArrayLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">]</span>

<span class="c1"># TODO maybe this needs to be abstract</span>
<span class="c1"># ikine functions need: fkine, jacobe, qlim methods from subclass</span>


<div class="viewcode-block" id="Robot"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot">[docs]</a><span class="k">class</span> <span class="nc">Robot</span><span class="p">(</span><span class="n">SceneNode</span><span class="p">,</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">DynamicsMixin</span><span class="p">):</span>

    <span class="n">_color</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">links</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;noname&quot;</span><span class="p">,</span>
        <span class="n">manufacturer</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">base</span><span class="o">=</span><span class="n">SE3</span><span class="p">(),</span>
        <span class="n">tool</span><span class="o">=</span><span class="n">SE3</span><span class="p">(),</span>
        <span class="n">gravity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">keywords</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">symbolic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">configs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manufacturer</span> <span class="o">=</span> <span class="n">manufacturer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span> <span class="o">=</span> <span class="n">symbolic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reach</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Initialise the scene node</span>
        <span class="n">SceneNode</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_T</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>

        <span class="k">if</span> <span class="n">keywords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;keywords must be a list or tuple&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="n">keywords</span>

        <span class="c1"># gravity is in the negative-z direction.  This is the negative of the</span>
        <span class="c1"># MATLAB Toolbox case (which was wrong).</span>
        <span class="k">if</span> <span class="n">gravity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gravity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="n">gravity</span>

        <span class="c1"># validate the links, must be a list of Link subclass objects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The links must be stored in a list.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hasdynamics</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hasgeometry</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hascollision</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">BaseLink</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;links should all be Link subclass&quot;</span><span class="p">)</span>

            <span class="c1"># add link back to roboto</span>
            <span class="n">link</span><span class="o">.</span><span class="n">_robot</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">hasdynamics</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hasdynamics</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">geometry</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hasgeometry</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">collision</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hascollision</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">Link</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hasgeometry</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="n">links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nlinks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>

        <span class="c1"># Current joint angles of the robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">control_mode</span> <span class="o">=</span> <span class="s2">&quot;v&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dynchanged</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set up named configuration property</span>
        <span class="k">if</span> <span class="n">configs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span> <span class="o">=</span> <span class="n">configs</span>

<div class="viewcode-block" id="Robot.copy"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>

        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">)</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="p">)</span>
        <span class="n">gravity</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="p">)</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
        <span class="n">symbolic</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">)</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">links</span><span class="o">=</span><span class="n">links</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">manufacturer</span><span class="o">=</span><span class="n">manufacturer</span><span class="p">,</span>
            <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span>
            <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
            <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
            <span class="n">gravity</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
            <span class="n">keywords</span><span class="o">=</span><span class="n">keywords</span><span class="p">,</span>
            <span class="n">symbolic</span><span class="o">=</span><span class="n">symbolic</span><span class="p">,</span>
            <span class="n">configs</span><span class="o">=</span><span class="n">configs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># if a configuration was an attribute of original robot, make it an</span>
        <span class="c1"># attribute of the deep copy</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">configs</span><span class="p">[</span><span class="n">config</span><span class="p">])</span>

        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">):</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">link</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

<div class="viewcode-block" id="Robot.__getitem__"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.__getitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get link (Robot superclass)</span>

<span class="sd">        :param i: link number or name</span>
<span class="sd">        :type i: int or str</span>
<span class="sd">        :return: i&#39;th link or named link</span>
<span class="sd">        :rtype: Link subclass</span>

<span class="sd">        This also supports iterating over each link in the robot object,</span>
<span class="sd">        from the base to the tool.</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; print(robot[1]) # print the 2nd link</span>
<span class="sd">            &gt;&gt;&gt; print([link.a for link in robot])  # print all the a_j values</span>

<span class="sd">        .. note:: ``ERobot`` supports link lookup by name,</span>
<span class="sd">            eg. ``robot[&#39;link1&#39;]``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

    <span class="c1"># URDF Parser Attempt</span>
    <span class="c1"># @staticmethod</span>
    <span class="c1"># def _get_stl_file_paths_and_scales(urdf_path):</span>
    <span class="c1">#     data = [[], [], []]  # [ [filenames] , [scales] , [origins] ]</span>
    <span class="c1">#</span>
    <span class="c1">#     name, ext = splitext(urdf_path)</span>
    <span class="c1">#</span>
    <span class="c1">#     if ext == &#39;.xacro&#39;:</span>
    <span class="c1">#         urdf_string = xacro.main(urdf_path)</span>
    <span class="c1">#         urdf = URDF.loadstr(urdf_string, urdf_path)</span>
    <span class="c1">#</span>
    <span class="c1">#         for link in urdf.links:</span>
    <span class="c1">#             data[0].append(link.visuals[0].geometry.mesh.filename)</span>
    <span class="c1">#             data[1].append(link.visuals[0].geometry.mesh.scale)</span>
    <span class="c1">#             data[2].append(SE3(link.visuals[0].origin))</span>
    <span class="c1">#</span>
    <span class="c1">#     return data</span>

<div class="viewcode-block" id="Robot.dynchanged"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.dynchanged">[docs]</a>    <span class="k">def</span> <span class="nf">dynchanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamic parameters have changed (Robot superclass)</span>

<span class="sd">        Called from a property setter to inform the robot that the cache of</span>
<span class="sd">        dynamic parameters is invalid.</span>

<span class="sd">        :seealso: :func:`roboticstoolbox.Link._listen_dyn`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dynchanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">what</span> <span class="o">!=</span> <span class="s2">&quot;gravity&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hasdynamics</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_getq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get joint coordinates (Robot superclass)</span>

<span class="sd">        :param q: passed value, defaults to None</span>
<span class="sd">        :type q: array_like, optional</span>
<span class="sd">        :return: passed or value from robot state</span>
<span class="sd">        :rtype: ndarray(n,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
        <span class="k">elif</span> <span class="n">isvector</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">getvector</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">getmatrix</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of joints (Robot superclass)</span>

<span class="sd">        :return: Number of joints</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.n</span>

<span class="sd">        :seealso: :func:`nlinks`, :func:`nbranches`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nlinks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of links (Robot superclass)</span>

<span class="sd">        :return: Number of links</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.nlinks</span>

<span class="sd">        :seealso: :func:`n`, :func:`nbranches`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nlinks</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">configs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">nbranches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of branches (Robot superclass)</span>

<span class="sd">        :return: Number of branches</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.nbranches</span>

<span class="sd">        :seealso: :func:`n`, :func:`nlinks`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasdynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Robot has dynamic parameters (Robot superclass)</span>

<span class="sd">        :return: Robot has dynamic parameters</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        At least one link has associated dynamic parameters.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.hasdynamics:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasdynamics</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasgeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Robot has geometry model (Robot superclass)</span>

<span class="sd">        :return: Robot has geometry model</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        At least one link has associated mesh to describe its shape.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.hasgeometry</span>

<span class="sd">        :seealso: :func:`hascollision`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasgeometry</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hascollision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Robot has collision model (Robot superclass)</span>

<span class="sd">        :return: Robot has collision model</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        At least one link has associated collision model.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.hascollision</span>

<span class="sd">        :seealso: :func:`hasgeometry`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hascollision</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qrandom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a random joint configuration</span>

<span class="sd">        :return: Random joint configuration :rtype: ndarray(n)</span>

<span class="sd">        The value for each joint is uniform randomly distributed  between the</span>
<span class="sd">        limits set for the robot.</span>

<span class="sd">        .. note:: The joint limit for all joints must be set.</span>

<span class="sd">        :seealso: :func:`Robot.qlim`, :func:`Link.qlim`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qlim</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">qlim</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;some joint limits not defined&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">qlim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">high</span><span class="o">=</span><span class="n">qlim</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get default graphical backend</span>

<span class="sd">        :return: backend name</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        Get the default graphical backend, used when no explicit backend is</span>
<span class="sd">        passed to ``Robot.plot``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_default_backend</span>

    <span class="nd">@default_backend</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">default_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">be</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set default graphical backend</span>

<span class="sd">        :param be: backend name</span>
<span class="sd">        :type be: str</span>

<span class="sd">        Set the default graphical backend, used when no explicit backend is</span>
<span class="sd">        passed to ``Robot.plot``.  The default set here will be overridden if</span>
<span class="sd">        the particular ``Robot`` subclass cannot support it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_default_backend</span> <span class="o">=</span> <span class="n">be</span>

<div class="viewcode-block" id="Robot.addconfiguration_attr"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.addconfiguration_attr">[docs]</a>    <span class="k">def</span> <span class="nf">addconfiguration_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rad&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a named joint configuration as an attribute (Robot superclass)</span>

<span class="sd">        :param name: Name of the joint configuration</span>
<span class="sd">        :param q: Joint configuration</span>
<span class="sd">        :type q: Arraylike</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.addconfiguration_attr(&quot;mypos&quot;, [0.1, 0.2, 0.3, 0.4, 0.5, 0.6])</span>
<span class="sd">            &gt;&gt;&gt; robot.mypos</span>
<span class="sd">            &gt;&gt;&gt; robot.configs[&quot;mypos&quot;]</span>

<span class="sd">        .. note::</span>
<span class="sd">            - Used in robot model init method to store the ``qr`` configuration</span>
<span class="sd">            - Dynamically adding attributes to objects can cause issues with</span>
<span class="sd">              Python type checking.</span>
<span class="sd">            - Configuration is also added to the robot instance&#39;s dictionary of</span>
<span class="sd">              named configurations.</span>

<span class="sd">        :seealso: :meth:`addconfiguration`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">getvector</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">getunit</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="Robot.addconfiguration"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.addconfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">addconfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a named joint configuration (Robot superclass)</span>

<span class="sd">        :param name: Name of the joint configuration</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param q: Joint configuration</span>
<span class="sd">        :type q: ndarray(n) or list</span>

<span class="sd">        Add a named configuration to the robot instance&#39;s dictionary of named</span>
<span class="sd">        configurations.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.addconfiguration_attr(&quot;mypos&quot;, [0.1, 0.2, 0.3, 0.4, 0.5, 0.6])</span>
<span class="sd">            &gt;&gt;&gt; robot.configs[&quot;mypos&quot;]</span>

<span class="sd">        :seealso: :meth:`addconfiguration`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></div>

<div class="viewcode-block" id="Robot.configurations_str"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.configurations_str">[docs]</a>    <span class="k">def</span> <span class="nf">configurations_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="s2">&quot;thin&quot;</span><span class="p">):</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="c1"># TODO: factor this out of DHRobot</span>
        <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># pragma nocover</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">theta</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span>

        <span class="c1"># show named configurations</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">ANSITable</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">colalign</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">),</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="n">Column</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q</span><span class="si">{</span><span class="n">j</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">colalign</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">headalign</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
                <span class="p">],</span>
                <span class="n">border</span><span class="o">=</span><span class="n">border</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">qlist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
                        <span class="n">qlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s2"> .3g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">qlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{: .3g}</span><span class="s2">&quot;</span><span class="p">))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">qlist</span><span class="p">)</span>

            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma nocover</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the joint structure string</span>

<span class="sd">        :return: joint configuration string</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        A string with one letter per joint: ``R`` for a revolute</span>
<span class="sd">        joint, and ``P`` for a prismatic joint.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; puma = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; puma.structure</span>
<span class="sd">            &gt;&gt;&gt; stanford = rtb.models.DH.Stanford()</span>
<span class="sd">            &gt;&gt;&gt; stanford.structure</span>

<span class="sd">        .. note:: Fixed joints, that maintain a constant link relative pose,</span>
<span class="sd">            are not included.  ``len(self.structure) == self.n``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">isrevolute</span><span class="p">:</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">link</span><span class="o">.</span><span class="n">isprismatic</span><span class="p">:</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">revolutejoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revolute joints as bool array</span>

<span class="sd">        :return: array of joint type, True if revolute</span>
<span class="sd">        :rtype: bool(n)</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; puma = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; puma.revolutejoints()</span>
<span class="sd">            &gt;&gt;&gt; stanford = rtb.models.DH.Stanford()</span>
<span class="sd">            &gt;&gt;&gt; stanford.revolutejoints()</span>

<span class="sd">        .. note:: Fixed joints, that maintain a constant link relative pose,</span>
<span class="sd">            are not included.  ``len(self.structure) == self.n``.</span>

<span class="sd">        :seealso: :func:`Link.isrevolute`, :func:`prismaticjoints`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">isrevolute</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">isjoint</span><span class="p">]</span>

    <span class="c1"># TODO not very efficient</span>
    <span class="c1"># TODO keep a mapping from joint to link</span>
<div class="viewcode-block" id="Robot.isrevolute"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.isrevolute">[docs]</a>    <span class="k">def</span> <span class="nf">isrevolute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">revolutejoints</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></div>

<div class="viewcode-block" id="Robot.isprismatic"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.isprismatic">[docs]</a>    <span class="k">def</span> <span class="nf">isprismatic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prismaticjoints</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prismaticjoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revolute joints as bool array</span>

<span class="sd">        :return: array of joint type, True if prismatic</span>
<span class="sd">        :rtype: bool(n)</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; puma = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; puma.prismaticjoints()</span>
<span class="sd">            &gt;&gt;&gt; stanford = rtb.models.DH.Stanford()</span>
<span class="sd">            &gt;&gt;&gt; stanford.prismaticjoints()</span>

<span class="sd">        .. note:: Fixed joints, that maintain a constant link relative pose,</span>
<span class="sd">            are not included.  ``len(self.structure) == self.n``.</span>

<span class="sd">        :seealso: :func:`Link.isprismatic`, :func:`revolutejoints`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">isprismatic</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">isjoint</span><span class="p">]</span>

<div class="viewcode-block" id="Robot.todegrees"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.todegrees">[docs]</a>    <span class="k">def</span> <span class="nf">todegrees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert joint angles to degrees</span>

<span class="sd">        :param q: The joint configuration of the robot</span>
<span class="sd">        :type q: ndarray(n) or ndarray(m,n)</span>
<span class="sd">        :return: a vector of joint coordinates in degrees and metres</span>
<span class="sd">        :rtype: ndarray(n)  or ndarray(m,n)</span>

<span class="sd">        ``robot.todegrees(q)`` converts joint coordinates ``q`` to degrees</span>
<span class="sd">        taking into account whether elements of ``q`` correspond to revolute</span>
<span class="sd">        or prismatic joints, ie. prismatic joint values are not converted.</span>

<span class="sd">        If ``q`` is a matrix, with one column per joint, the conversion is</span>
<span class="sd">        performed columnwise.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; from math import pi</span>
<span class="sd">            &gt;&gt;&gt; stanford = rtb.models.DH.Stanford()</span>
<span class="sd">            &gt;&gt;&gt; stanford.todegrees([pi/4, pi/8, 2, -pi/4, pi/6, pi/3])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">getmatrix</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">revolute</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revolutejoints</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">revolute</span><span class="p">:</span>
                <span class="n">q</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q</span></div>

<div class="viewcode-block" id="Robot.toradians"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.toradians">[docs]</a>    <span class="k">def</span> <span class="nf">toradians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert joint angles to radians</span>

<span class="sd">        :param q: The joint configuration of the robot</span>
<span class="sd">        :type q: ndarray(n)  or ndarray(m,n)</span>
<span class="sd">        :return: a vector of joint coordinates in radians and metres</span>
<span class="sd">        :rtype: ndarray(n)  or ndarray(m,n)</span>

<span class="sd">        ``robot.toradians(q)`` converts joint coordinates ``q`` to radians</span>
<span class="sd">        taking into account whether elements of ``q`` correspond to revolute</span>
<span class="sd">        or prismatic joints, ie. prismatic joint values are not converted.</span>

<span class="sd">        If ``q`` is a matrix, with one column per joint, the conversion is</span>
<span class="sd">        performed columnwise.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; stanford = rtb.models.DH.Stanford()</span>
<span class="sd">            &gt;&gt;&gt; stanford.toradians([10, 20, 2, 30, 40, 50])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">getmatrix</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">revolute</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revolutejoints</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">revolute</span><span class="p">:</span>
                <span class="n">q</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
        <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q</span></div>

<div class="viewcode-block" id="Robot.linkcolormap"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.linkcolormap">[docs]</a>    <span class="k">def</span> <span class="nf">linkcolormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linkcolors</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a colormap for robot joints</span>

<span class="sd">        :param linkcolors: list of colors or colormap, defaults to &quot;viridis&quot;</span>
<span class="sd">        :type linkcolors: list or str, optional</span>
<span class="sd">        :return: color map</span>
<span class="sd">        :rtype: matplotlib.colors.ListedColormap</span>

<span class="sd">        - ``cm = robot.linkcolormap()`` is an n-element colormap that gives a</span>
<span class="sd">          unique color for every link.  The RGBA colors for link ``j`` are</span>
<span class="sd">          ``cm(j)``.</span>
<span class="sd">        - ``cm = robot.linkcolormap(cmap)`` as above but ``cmap`` is the name</span>
<span class="sd">          of a valid matplotlib colormap.  The default, example above, is the</span>
<span class="sd">          ``viridis`` colormap.</span>
<span class="sd">        - ``cm = robot.linkcolormap(list of colors)`` as above but a</span>
<span class="sd">          colormap is created from a list of n color names given as strings,</span>
<span class="sd">          tuples or hexstrings.</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; cm = robot.linkcolormap(&quot;inferno&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(cm(range(6))) # cm(i) is 3rd color in colormap</span>
<span class="sd">            &gt;&gt;&gt; cm = robot.linkcolormap(</span>
<span class="sd">            &gt;&gt;&gt;     [&#39;red&#39;, &#39;g&#39;, (0,0.5,0), &#39;#0f8040&#39;, &#39;yellow&#39;, &#39;cyan&#39;])</span>
<span class="sd">            &gt;&gt;&gt; print(cm(range(6)))</span>

<span class="sd">        .. note::</span>

<span class="sd">            - Colormaps have 4-elements: red, green, blue, alpha (RGBA)</span>
<span class="sd">            - Names of supported colors and colormaps are defined in the</span>
<span class="sd">              matplotlib documentation.</span>

<span class="sd">                - `Specifying colors</span>
<span class="sd">                &lt;https://matplotlib.org/3.1.0/tutorials/colors/colors.html#sphx-glr-tutorials-colors-colors-py&gt;`_</span>
<span class="sd">                - `Colormaps</span>
<span class="sd">                &lt;https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html#sphx-glr-tutorials-colors-colormaps-py&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linkcolors</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">linkcolors</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="c1"># provided a list of color names</span>
            <span class="k">return</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">linkcolors</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># assume it is a colormap name</span>
            <span class="k">return</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">linkcolors</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></div>

<div class="viewcode-block" id="Robot.jtraj"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.jtraj">[docs]</a>    <span class="k">def</span> <span class="nf">jtraj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Joint-space trajectory between SE(3) poses</span>

<span class="sd">        :param T1: initial end-effector pose</span>
<span class="sd">        :type T1: SE3 instance</span>
<span class="sd">        :param T2: final end-effector pose</span>
<span class="sd">        :type T2: SE3 instance</span>
<span class="sd">        :param t: time vector or number of steps</span>
<span class="sd">        :type t: ndarray(m) or int</span>
<span class="sd">        :param kwargs: arguments passed to the IK solver</span>
<span class="sd">        :return: trajectory</span>
<span class="sd">        :rtype: Trajectory instance</span>

<span class="sd">        ``traj = obot.jtraj(T1, T2, t)`` is a trajectory object whose</span>
<span class="sd">        attribute ``traj.q`` is a row-wise joint-space trajectory.</span>

<span class="sd">        The initial and final poses are mapped to joint space using inverse</span>
<span class="sd">        kinematics:</span>

<span class="sd">        - if the object has an analytic solution ``ikine_a`` that will be used,</span>
<span class="sd">        - otherwise the general numerical algorithm ``ikine_min`` will be used.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;ikine_a&quot;</span><span class="p">):</span>
            <span class="n">ik</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ikine_a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ik</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ikine_min</span>

        <span class="n">q1</span> <span class="o">=</span> <span class="n">ik</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">ik</span><span class="p">(</span><span class="n">T2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rtb</span><span class="o">.</span><span class="n">jtraj</span><span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">q2</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="Robot.manipulability"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.manipulability">[docs]</a>    <span class="k">def</span> <span class="nf">manipulability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;yoshikawa&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manipulability measure</span>

<span class="sd">        :param q: Joint coordinates, one of J or q required</span>
<span class="sd">        :type q: ndarray(n), or ndarray(m,n)</span>
<span class="sd">        :param J: Jacobian in world frame if already computed, one of J or</span>
<span class="sd">            q required</span>
<span class="sd">        :type J: ndarray(6,n)</span>
<span class="sd">        :param method: method to use, &quot;yoshikawa&quot; (default), &quot;condition&quot;,</span>
<span class="sd">            &quot;minsingular&quot;  or &quot;asada&quot;</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :param axes: Task space axes to consider: &quot;all&quot; [default],</span>
<span class="sd">            &quot;trans&quot;, &quot;rot&quot; or &quot;both&quot;</span>
<span class="sd">        :type axes: str</span>
<span class="sd">        :param kwargs: extra arguments to pass to ``jacob0``</span>
<span class="sd">        :return: manipulability</span>
<span class="sd">        :rtype: float or ndarray(m)</span>

<span class="sd">        - ``manipulability(q)`` is the scalar manipulability index</span>
<span class="sd">          for the robot at the joint configuration ``q``.  It indicates</span>
<span class="sd">          dexterity, that is, how well conditioned the robot is for motion</span>
<span class="sd">          with respect to the 6 degrees of Cartesian motion.  The values is</span>
<span class="sd">          zero if the robot is at a singularity.</span>

<span class="sd">        Various measures are supported:</span>

<span class="sd">        +-------------------+-------------------------------------------------+</span>
<span class="sd">        | Measure           |       Description                               |</span>
<span class="sd">        +-------------------+-------------------------------------------------+</span>
<span class="sd">        | ``&quot;yoshikawa&quot;``   | Volume of the velocity ellipsoid, *distance*    |</span>
<span class="sd">        |                   | from singularity [Yoshikawa85]_                 |</span>
<span class="sd">        +-------------------+-------------------------------------------------+</span>
<span class="sd">        | ``&quot;invcondition&quot;``| Inverse condition number of Jacobian, isotropy  |</span>
<span class="sd">        |                   | of the velocity ellipsoid [Klein87]_            |</span>
<span class="sd">        +-------------------+-------------------------------------------------+</span>
<span class="sd">        | ``&quot;minsingular&quot;`` | Minimum singular value of the Jacobian,         |</span>
<span class="sd">        |                   | *distance*  from singularity [Klein87]_         |</span>
<span class="sd">        +-------------------+-------------------------------------------------+</span>
<span class="sd">        | ``&quot;asada&quot;``       | Isotropy of the task-space acceleration         |</span>
<span class="sd">        |                   | ellipsoid which is a function of the Cartesian  |</span>
<span class="sd">        |                   | inertia matrix which depends on the inertial    |</span>
<span class="sd">        |                   | parameters [Asada83]_                           |</span>
<span class="sd">        +-------------------+-------------------------------------------------+</span>

<span class="sd">        **Trajectory operation**:</span>

<span class="sd">        If ``q`` is a matrix (m,n) then the result (m,) is a vector of</span>
<span class="sd">        manipulability indices for each joint configuration specified by a row</span>
<span class="sd">        of ``q``.</span>

<span class="sd">        .. note::</span>

<span class="sd">            - Invokes the ``jacob0`` method of the robot if ``J`` is not passed</span>
<span class="sd">            - The &quot;all&quot; option includes rotational and translational</span>
<span class="sd">              dexterity, but this involves adding different units. It can be</span>
<span class="sd">              more useful to look at the translational and rotational</span>
<span class="sd">              manipulability separately.</span>
<span class="sd">            - Examples in the RVC book (1st edition) can be replicated by</span>
<span class="sd">              using the &quot;all&quot; option</span>
<span class="sd">            - Asada&#39;s measure requires inertial a robot model with inertial</span>
<span class="sd">              parameters.</span>

<span class="sd">        :references:</span>

<span class="sd">        .. [Yoshikawa85] Manipulability of Robotic Mechanisms. Yoshikawa T.,</span>
<span class="sd">                The International Journal of Robotics Research.</span>
<span class="sd">                1985;4(2):3-9. doi:10.1177/027836498500400201</span>
<span class="sd">        .. [Asada83] A geometrical representation of manipulator dynamics and</span>
<span class="sd">                its application to arm design, H. Asada,</span>
<span class="sd">                Journal of Dynamic Systems, Measurement, and Control,</span>
<span class="sd">                vol. 105, p. 131, 1983.</span>
<span class="sd">        .. [Klein87] Dexterity Measures for the Design and Control of</span>
<span class="sd">                Kinematically Redundant Manipulators. Klein CA, Blaho BE.</span>
<span class="sd">                The International Journal of Robotics Research.</span>
<span class="sd">                1987;6(2):72-83. doi:10.1177/027836498700600206</span>

<span class="sd">        - Robotics, Vision &amp; Control, Chap 8, P. Corke, Springer 2011.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">axes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">axes</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;trans&quot;</span><span class="p">):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">axes</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rot&quot;</span><span class="p">):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">axes</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manipulability</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s2">&quot;trans&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manipulability</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s2">&quot;rot&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axes must be all, trans, rot or both&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">yoshikawa</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="n">axes</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">if</span> <span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># simplified case for square matrix</span>
                <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span> <span class="o">@</span> <span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">condition</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="n">axes</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>  <span class="c1"># return 1/cond(J)</span>

        <span class="k">def</span> <span class="nf">minsingular</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="n">axes</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">compute_uv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># return last/smallest singular value of J</span>

        <span class="k">def</span> <span class="nf">asada</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># dof = np.sum(axes)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="n">Ji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
            <span class="n">Mx</span> <span class="o">=</span> <span class="n">Ji</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">robot</span><span class="o">.</span><span class="n">inertia</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">@</span> <span class="n">Ji</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">axes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Mx</span> <span class="o">=</span> <span class="n">Mx</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="n">Mx</span> <span class="o">=</span> <span class="n">Mx</span><span class="p">[:,</span> <span class="n">d</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
            <span class="n">e</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">Mx</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># choose the handler function</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;yoshikawa&quot;</span><span class="p">:</span>
            <span class="n">mfunc</span> <span class="o">=</span> <span class="n">yoshikawa</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;invcondition&quot;</span><span class="p">:</span>
            <span class="n">mfunc</span> <span class="o">=</span> <span class="n">condition</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;minsingular&quot;</span><span class="p">:</span>
            <span class="n">mfunc</span> <span class="o">=</span> <span class="n">minsingular</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;asada&quot;</span><span class="p">:</span>
            <span class="n">mfunc</span> <span class="o">=</span> <span class="n">asada</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid method chosen&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate manipulability based on supplied Jacobian</span>
        <span class="k">if</span> <span class="n">J</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="n">mfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">axes</span><span class="p">)]</span>

        <span class="c1"># Otherwise use the q vector/matrix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">getmatrix</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
                <span class="n">Jk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacob0</span><span class="p">(</span><span class="n">qk</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Jk</span><span class="p">,</span> <span class="n">qk</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">w</span></div>

<div class="viewcode-block" id="Robot.jacob0_dot"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.jacob0_dot">[docs]</a>    <span class="k">def</span> <span class="nf">jacob0_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">J0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">representation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivative of Jacobian</span>

<span class="sd">        :param q: The joint configuration of the robot</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param qd: The joint velocity of the robot</span>
<span class="sd">        :type qd: ndarray(n)</span>
<span class="sd">        :param J0: Jacobian in {0} frame</span>
<span class="sd">        :type J0: ndarray(6,n)</span>
<span class="sd">        :param representation: angular representation</span>
<span class="sd">        :type representation: str</span>
<span class="sd">        :return: The derivative of the manipulator Jacobian</span>
<span class="sd">        :rtype:  ndarray(6,n)</span>

<span class="sd">        ``robot.jacob_dot(q, qd)`` computes the rate of change of the</span>
<span class="sd">        Jacobian elements</span>

<span class="sd">        .. math::</span>

<span class="sd">            \dmat{J} = \frac{d \mat{J}}{d \vec{q}} \frac{d \vec{q}}{dt}</span>

<span class="sd">        where the first term is the rank-3 Hessian.</span>

<span class="sd">         If ``J0`` is already calculated for the joint</span>
<span class="sd">        coordinates ``q`` it can be passed in to to save computation time.</span>

<span class="sd">        It is computed as the mode-3 product of the Hessian tensor and the</span>
<span class="sd">        velocity vector.</span>

<span class="sd">        The derivative of an analytical Jacobian can be obtained by setting</span>
<span class="sd">        ``representation`` as</span>

<span class="sd">        ==================   ==================================</span>
<span class="sd">        ``representation``          Rotational representation</span>
<span class="sd">        ==================   ==================================</span>
<span class="sd">        ``&#39;rpy/xyz&#39;``        RPY angular rates in XYZ order</span>
<span class="sd">        ``&#39;rpy/zyx&#39;``        RPY angular rates in XYZ order</span>
<span class="sd">        ``&#39;eul&#39;``            Euler angular rates in ZYZ order</span>
<span class="sd">        ``&#39;exp&#39;``            exponential coordinate rates</span>
<span class="sd">        ==================   ==================================</span>

<span class="sd">        :references:</span>
<span class="sd">            - Kinematic Derivatives using the Elementary Transform</span>
<span class="sd">              Sequence, J. Haviland and P. Corke</span>

<span class="sd">        :seealso: :func:`jacob0`, :func:`hessian0`</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="c1"># n = len(q)</span>

        <span class="k">if</span> <span class="n">representation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">J0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">J0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacob0</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hessian0</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">J0</span><span class="o">=</span><span class="n">J0</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># # determine analytic rotation</span>
            <span class="c1"># T = self.fkine(q).A</span>
            <span class="c1"># gamma = smb.r2x(smb.t2r(T), representation=representation)</span>

            <span class="c1"># # get transformation angular velocity to analytic velocity</span>
            <span class="c1"># Ai = smb.rotvelxform(</span>
            <span class="c1">#     gamma, representation=representation, inverse=True, full=True</span>
            <span class="c1"># )</span>

            <span class="c1"># # get analytic rate from joint rates</span>
            <span class="c1"># omega = J0[3:, :] @ qd</span>
            <span class="c1"># gamma_dot = Ai[3:, 3:] @ omega</span>
            <span class="c1"># Ai_dot = smb.rotvelxform_inv_dot(gamma, gamma_dot, full=True)</span>
            <span class="c1"># Ai_dot = sp.linalg.block_diag(np.zeros((3, 3)), Ai_dot)</span>

            <span class="c1"># Jd = Ai_dot @ J0 + Ai @ Jd</span>

            <span class="c1"># not actually sure this can be written in closed form</span>

            <span class="n">H</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">numhess</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacob0_analytical</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">representation</span><span class="o">=</span><span class="n">representation</span><span class="p">),</span> <span class="n">q</span>
            <span class="p">)</span>
            <span class="c1"># Jd = Ai @ Jd</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">qd</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>

<div class="viewcode-block" id="Robot.jacobm"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.jacobm">[docs]</a>    <span class="k">def</span> <span class="nf">jacobm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the manipulability Jacobian. This measure relates the rate</span>
<span class="sd">        of change of the manipulability to the joint velocities of the robot.</span>
<span class="sd">        One of J or q is required. Supply J and H if already calculated to</span>
<span class="sd">        save computation time</span>

<span class="sd">        :param q: The joint angles/configuration of the robot (Optional,</span>
<span class="sd">            if not supplied will use the stored q values).</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param J: The manipulator Jacobian in any frame</span>
<span class="sd">        :type J: float ndarray(6,n)</span>
<span class="sd">        :param H: The manipulator Hessian in any frame</span>
<span class="sd">        :type H: float ndarray(6,n,n)</span>
<span class="sd">        :param end: the final link or Gripper which the Hessian represents</span>
<span class="sd">        :type end: str or ELink or Gripper</span>
<span class="sd">        :param start: the first link which the Hessian represents</span>
<span class="sd">        :type start: str or ELink</span>

<span class="sd">        :return: The manipulability Jacobian</span>
<span class="sd">        :rtype: float ndarray(n)</span>

<span class="sd">        Yoshikawa&#39;s manipulability measure</span>

<span class="sd">        .. math::</span>

<span class="sd">            m(\vec{q}) = \sqrt{\mat{J}(\vec{q}) \mat{J}(\vec{q})^T}</span>

<span class="sd">        This method returns its Jacobian with respect to configuration</span>

<span class="sd">        .. math::</span>

<span class="sd">            \frac{\partial m(\vec{q})}{\partial \vec{q}}</span>

<span class="sd">        :references:</span>
<span class="sd">            - Kinematic Derivatives using the Elementary Transform</span>
<span class="sd">              Sequence, J. Haviland and P. Corke</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">end</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_limit_links</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
        <span class="c1"># path, n, _ = self.get_path(end, start)</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">axes</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;trans&quot;</span><span class="p">):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">axes</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rot&quot;</span><span class="p">):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axes must be all, trans or rot&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">J</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">getvector</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

            <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacob0</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifymatrix</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hessian0</span><span class="p">(</span><span class="n">J0</span><span class="o">=</span><span class="n">J</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifymatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

        <span class="n">manipulability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulability</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="n">axes</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">H</span><span class="p">[:,</span> <span class="n">axes</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">J</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
        <span class="n">Jm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">J</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="n">Jm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">manipulability</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">))</span> <span class="o">@</span> <span class="n">b</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Jm</span></div>

<div class="viewcode-block" id="Robot.ets"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.ets">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">ets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ETS</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Robot.jacob0_analytical"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.jacob0_analytical">[docs]</a>    <span class="k">def</span> <span class="nf">jacob0_analytical</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
        <span class="n">representation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rpy/xyz&quot;</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Link</span><span class="p">,</span> <span class="n">Gripper</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Link</span><span class="p">,</span> <span class="n">Gripper</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">SE3</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manipulator analytical Jacobian in the ``start`` frame</span>

<span class="sd">        :param q: Joint coordinate vector</span>
<span class="sd">        :type q: Arraylike</span>
<span class="sd">        :param representation: angular representation</span>
<span class="sd">        :type representation: str</span>
<span class="sd">        :param end: the particular link or gripper whose velocity the Jacobian</span>
<span class="sd">            describes, defaults to the base link</span>
<span class="sd">        :param start: the link considered as the end-effector, defaults to the robots&#39;s end-effector</span>
<span class="sd">        :param tool: a static tool transformation matrix to apply to the</span>
<span class="sd">            end of end, defaults to None</span>

<span class="sd">        :return J: Manipulator Jacobian in the ``start`` frame</span>

<span class="sd">        - ``robot.jacob0_analytical(q)`` is the manipulator Jacobian matrix which maps</span>
<span class="sd">          joint  velocity to end-effector spatial velocity expressed in the</span>
<span class="sd">          ``start`` frame.</span>

<span class="sd">        End-effector spatial velocity :math:`\nu = (v_x, v_y, v_z, \omega_x, \omega_y, \omega_z)^T`</span>
<span class="sd">        is related to joint velocity by :math:`{}^{E}\!\nu = \mathbf{J}_m(q) \dot{q}`.</span>

<span class="sd">        ==================   ==================================</span>
<span class="sd">        ``representation``          Rotational representation</span>
<span class="sd">        ==================   ==================================</span>
<span class="sd">        ``&#39;rpy/xyz&#39;``        RPY angular rates in XYZ order</span>
<span class="sd">        ``&#39;rpy/zyx&#39;``        RPY angular rates in XYZ order</span>
<span class="sd">        ``&#39;eul&#39;``            Euler angular rates in ZYZ order</span>
<span class="sd">        ``&#39;exp&#39;``            exponential coordinate rates</span>
<span class="sd">        ==================   ==================================</span>

<span class="sd">        Example:</span>
<span class="sd">        .. runblock:: pycon</span>
<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; puma = rtb.models.ETS.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; puma.jacob0_analytical([0, 0, 0, 0, 0, 0])</span>

<span class="sd">        .. warning:: ``start`` and ``end`` must be on the same branch,</span>
<span class="sd">            with ``start`` closest to the base.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ets</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">jacob0_analytical</span><span class="p">(</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">representation</span><span class="o">=</span><span class="n">representation</span>
        <span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot name (Robot superclass)</span>

<span class="sd">        - ``robot.name`` is the robot name</span>

<span class="sd">        :return: robot name</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        - ``robot.name = ...`` checks and sets therobot name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_new</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name_new</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">manufacturer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot manufacturer&#39;s name (Robot superclass)</span>

<span class="sd">        - ``robot.manufacturer`` is the robot manufacturer&#39;s name</span>

<span class="sd">        :return: robot manufacturer&#39;s name</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        - ``robot.manufacturer = ...`` checks and sets the manufacturer&#39;s name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manufacturer</span>

    <span class="nd">@manufacturer</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">manufacturer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manufacturer_new</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manufacturer</span> <span class="o">=</span> <span class="n">manufacturer_new</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Robot links (Robot superclass)</span>

<span class="sd">        :return: A list of link objects</span>
<span class="sd">        :rtype: list of Link subclass instances</span>

<span class="sd">        .. note:: It is probably more concise to index the robot object rather</span>
<span class="sd">            than the list of links, ie. the following are equivalent::</span>

<span class="sd">                robot.links[i]</span>
<span class="sd">                robot[i]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SE3</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot base transform (Robot superclass)</span>

<span class="sd">        - ``robot.base`` is the robot base transform</span>

<span class="sd">        :return: robot tool transform</span>

<span class="sd">        - ``robot.base = ...`` checks and sets the robot base transform</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># return a copy, otherwise somebody with</span>
        <span class="c1"># reference to the base can change it</span>

        <span class="c1"># This now returns the Scene Node transform</span>
        <span class="c1"># self._T is a copy of SceneNode.__T</span>
        <span class="k">return</span> <span class="n">SE3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_T</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@base</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">SE3</span><span class="p">]):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">Robot</span><span class="p">):</span>
            <span class="c1"># All 3D robots</span>
            <span class="c1"># Set the SceneNode T</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">SE3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">A</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_T</span> <span class="o">=</span> <span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;base must be set to None (no tool), SE2, or SE3&quot;</span><span class="p">)</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tool</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SE3</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot tool transform (Robot superclass)</span>

<span class="sd">        - ``robot.tool`` is the robot tool transform</span>

<span class="sd">        :return: robot tool transform</span>

<span class="sd">        - ``robot.tool = ...`` checks and sets the robot tool transform</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SE3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tool</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@tool</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SE3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">SE3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tool</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">A</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tool</span> <span class="o">=</span> <span class="n">T</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qlim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Joint limits (Robot superclass)</span>

<span class="sd">        :return: Array of joint limit values</span>
<span class="sd">        :rtype: ndarray(2,n)</span>
<span class="sd">        :exception ValueError: unset limits for a prismatic joint</span>

<span class="sd">        Limits are extracted from the link objects.  If joints limits are</span>
<span class="sd">        not set for:</span>

<span class="sd">            - a revolute joint [-. ] is returned</span>
<span class="sd">            - a prismatic joint an exception is raised</span>

<span class="sd">        Example:</span>

<span class="sd">        .. runblock:: pycon</span>

<span class="sd">            &gt;&gt;&gt; import roboticstoolbox as rtb</span>
<span class="sd">            &gt;&gt;&gt; robot = rtb.models.DH.Puma560()</span>
<span class="sd">            &gt;&gt;&gt; robot.qlim</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO tidy up</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">isrevolute</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">qlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">qlim</span>
            <span class="k">elif</span> <span class="n">link</span><span class="o">.</span><span class="n">isprismatic</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">qlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;undefined prismatic joint limit&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">qlim</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># fixed link</span>
                <span class="k">continue</span>

            <span class="n">limits</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">limits</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot joint configuration (Robot superclass)</span>

<span class="sd">        - ``robot.q`` is the robot joint configuration</span>

<span class="sd">        :return: robot joint configuration</span>
<span class="sd">        :rtype: ndarray(n,)</span>

<span class="sd">        - ``robot.q = ...`` checks and sets the joint configuration</span>

<span class="sd">        .. note::  ???</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span>

    <span class="nd">@q</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_new</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">getvector</span><span class="p">(</span><span class="n">q_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot joint velocity (Robot superclass)</span>

<span class="sd">        - ``robot.qd`` is the robot joint velocity</span>

<span class="sd">        :return: robot joint velocity</span>
<span class="sd">        :rtype: ndarray(n,)</span>

<span class="sd">        - ``robot.qd = ...`` checks and sets the joint velocity</span>

<span class="sd">        .. note::  ???</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qd</span>

    <span class="nd">@qd</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">qd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qd_new</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">getvector</span><span class="p">(</span><span class="n">qd_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qdd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot joint acceleration (Robot superclass)</span>

<span class="sd">        - ``robot.qdd`` is the robot joint acceleration</span>

<span class="sd">        :return: robot joint acceleration</span>
<span class="sd">        :rtype: ndarray(n,)</span>

<span class="sd">        - ``robot.qdd = ...`` checks and sets the robot joint acceleration</span>

<span class="sd">        .. note::  ???</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qdd</span>

    <span class="nd">@qdd</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">qdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qdd_new</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qdd</span> <span class="o">=</span> <span class="n">getvector</span><span class="p">(</span><span class="n">qdd_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set robot control mode (Robot superclass)</span>

<span class="sd">        - ``robot.control_type`` is the robot control mode</span>

<span class="sd">        :return: robot control mode</span>
<span class="sd">        :rtype: ndarray(n,)</span>

<span class="sd">        - ``robot.control_type = ...`` checks and sets the robot control mode</span>

<span class="sd">        .. note::  ???</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span>

    <span class="nd">@control_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cn</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cn</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span> <span class="ow">or</span> <span class="n">cn</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span> <span class="ow">or</span> <span class="n">cn</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span> <span class="o">=</span> <span class="n">cn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Control type must be one of &#39;p&#39;, &#39;v&#39;, or &#39;a&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="c1"># TODO probably should be a static method</span>
    <span class="k">def</span> <span class="nf">_get_graphical_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_backend</span>

        <span class="c1"># figure out the right default</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">DHRobot</span><span class="p">):</span>
                <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;pyplot&quot;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">ERobot2</span><span class="p">):</span>
                <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;pyplot2&quot;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">ERobot</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasgeometry</span><span class="p">:</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;swift&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;pyplot&quot;</span>

        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># find the right backend, modules are imported here on an as needs</span>
        <span class="c1"># basis</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;swift&quot;</span> <span class="ow">or</span> <span class="n">default</span> <span class="o">==</span> <span class="s2">&quot;swift&quot;</span><span class="p">:</span>  <span class="c1"># pragma nocover</span>
            <span class="c1"># swift was requested, is it installed?</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">DHRobot</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Plotting in Swift is not implemented for DHRobots yet&quot;</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># yes, use it</span>
                <span class="kn">from</span> <span class="nn">roboticstoolbox.backends.swift</span> <span class="kn">import</span> <span class="n">Swift</span>

                <span class="n">env</span> <span class="o">=</span> <span class="n">Swift</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">env</span>
            <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;swift&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Swift is not installed, &quot;</span> <span class="s2">&quot;install it using pip or conda&quot;</span><span class="p">)</span>
                <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;pyplot&quot;</span>

        <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;vpython&quot;</span> <span class="ow">or</span> <span class="n">default</span> <span class="o">==</span> <span class="s2">&quot;vpython&quot;</span><span class="p">:</span>  <span class="c1"># pragma nocover</span>
            <span class="c1"># vpython was requested, is it installed?</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">DHRobot</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Plotting in VPython is only implemented for DHRobots&quot;</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># yes, use it</span>
                <span class="kn">from</span> <span class="nn">roboticstoolbox.backends.VPython</span> <span class="kn">import</span> <span class="n">VPython</span>

                <span class="n">env</span> <span class="o">=</span> <span class="n">VPython</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">env</span>
            <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;vpython&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VPython is not installed, &quot;</span> <span class="s2">&quot;install it using pip or conda&quot;</span><span class="p">)</span>
                <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;pyplot&quot;</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">default</span>

        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;pyplot&quot;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">roboticstoolbox.backends.PyPlot</span> <span class="kn">import</span> <span class="n">PyPlot</span>

            <span class="n">env</span> <span class="o">=</span> <span class="n">PyPlot</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;pyplot2&quot;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">roboticstoolbox.backends.PyPlot</span> <span class="kn">import</span> <span class="n">PyPlot2</span>

            <span class="n">env</span> <span class="o">=</span> <span class="n">PyPlot2</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown backend&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">env</span>

<div class="viewcode-block" id="Robot.plot"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="mf">0.050</span><span class="p">,</span>
        <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vellipse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fellipse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">movie</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">loop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Graphical display and animation</span>

<span class="sd">        :param q: The joint configuration of the robot.</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param backend: The graphical backend to use, currently &#39;swift&#39;</span>
<span class="sd">            and &#39;pyplot&#39; are implemented. Defaults to &#39;swift&#39; of an ``ERobot``</span>
<span class="sd">            and &#39;pyplot` for a ``DHRobot``</span>
<span class="sd">        :type backend: string</span>
<span class="sd">        :param block: Block operation of the code and keep the figure open</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        :param dt: if q is a trajectory, this describes the delay in</span>
<span class="sd">            seconds between frames</span>
<span class="sd">        :type dt: float</span>
<span class="sd">        :param limits: Custom view limits for the plot. If not supplied will</span>
<span class="sd">            autoscale, [x1, x2, y1, y2, z1, z2]</span>
<span class="sd">            (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type limits: ndarray(6)</span>
<span class="sd">        :param vellipse: (Plot Option) Plot the velocity ellipse at the</span>
<span class="sd">            end-effector (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type vellipse: bool</span>
<span class="sd">        :param vellipse: (Plot Option) Plot the force ellipse at the</span>
<span class="sd">            end-effector (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type vellipse: bool</span>
<span class="sd">        :param jointaxes: (Plot Option) Plot an arrow indicating the axes in</span>
<span class="sd">            which the joint revolves around(revolute joint) or translates</span>
<span class="sd">            along (prosmatic joint) (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type jointaxes: bool</span>
<span class="sd">        :param eeframe: (Plot Option) Plot the end-effector coordinate frame</span>
<span class="sd">            at the location of the end-effector. Uses three arrows, red,</span>
<span class="sd">            green and blue to indicate the x, y, and z-axes.</span>
<span class="sd">            (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type eeframe: bool</span>
<span class="sd">        :param shadow: (Plot Option) Plot a shadow of the robot in the x-y</span>
<span class="sd">            plane. (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type shadow: bool</span>
<span class="sd">        :param name: (Plot Option) Plot the name of the robot near its base</span>
<span class="sd">            (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type name: bool</span>
<span class="sd">        :param movie: name of file in which to save an animated GIF</span>
<span class="sd">            (this option is for &#39;pyplot&#39; only)</span>
<span class="sd">        :type movie: str</span>

<span class="sd">        :return: A reference to the environment object which controls the</span>
<span class="sd">            figure</span>
<span class="sd">        :rtype: Swift or PyPlot</span>

<span class="sd">        - ``robot.plot(q, &#39;pyplot&#39;)`` displays a graphical view of a robot</span>
<span class="sd">          based on the kinematic model and the joint configuration ``q``.</span>
<span class="sd">          This is a stick figure polyline which joins the origins of the</span>
<span class="sd">          link coordinate frames. The plot will autoscale with an aspect</span>
<span class="sd">          ratio of 1.</span>

<span class="sd">        If ``q`` (m,n) representing a joint-space trajectory it will create an</span>
<span class="sd">        animation with a pause of ``dt`` seconds between each frame.</span>

<span class="sd">        .. note::</span>
<span class="sd">            - By default this method will block until the figure is dismissed.</span>
<span class="sd">              To avoid this set ``block=False``.</span>
<span class="sd">            - For PyPlot, the polyline joins the origins of the link frames,</span>
<span class="sd">              but for some Denavit-Hartenberg models those frames may not</span>
<span class="sd">              actually be on the robot, ie. the lines to not neccessarily</span>
<span class="sd">              represent the links of the robot.</span>

<span class="sd">        :seealso: :func:`teach`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">env</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_graphical_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">getmatrix</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Add the self to the figure in readonly mode</span>
        <span class="c1"># Add the self to the figure in readonly mode</span>
        <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; Plot&quot;</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; Trajectory Plot&quot;</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">env</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vellipse</span><span class="p">:</span>
            <span class="n">vell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vellipse</span><span class="p">(</span><span class="n">centre</span><span class="o">=</span><span class="s2">&quot;ee&quot;</span><span class="p">)</span>
            <span class="n">env</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vell</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fellipse</span><span class="p">:</span>
            <span class="n">fell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fellipse</span><span class="p">(</span><span class="n">centre</span><span class="o">=</span><span class="s2">&quot;ee&quot;</span><span class="p">)</span>
            <span class="n">env</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fell</span><span class="p">)</span>

        <span class="c1"># Stop lint error</span>
        <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of images saved from each plot</span>

        <span class="k">if</span> <span class="n">movie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">qk</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">qk</span>
                <span class="k">if</span> <span class="n">vellipse</span><span class="p">:</span>
                    <span class="n">vell</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">qk</span>
                <span class="k">if</span> <span class="n">fellipse</span><span class="p">:</span>
                    <span class="n">fell</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">qk</span>
                <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">movie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma nocover</span>
                    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">getframe</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">movie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma nocover</span>
                <span class="c1"># save it as an animated GIF</span>
                <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                    <span class="n">movie</span><span class="p">,</span>
                    <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                    <span class="n">optimize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">duration</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                    <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">loop</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Keep the plot open</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">env</span><span class="o">.</span><span class="n">hold</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">env</span></div>

    <span class="c1"># --------------------------------------------------------------------- #</span>

<div class="viewcode-block" id="Robot.fellipse"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.fellipse">[docs]</a>    <span class="k">def</span> <span class="nf">fellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s2">&quot;trans&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a force ellipsoid object for plotting with PyPlot</span>

<span class="sd">        :param q: The joint configuration of the robot (Optional,</span>
<span class="sd">            if not supplied will use the stored q values).</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param opt: &#39;trans&#39; or &#39;rot&#39; will plot either the translational or</span>
<span class="sd">            rotational force ellipsoid</span>
<span class="sd">        :type opt: string</span>
<span class="sd">        :param centre:</span>
<span class="sd">        :type centre: list or str(&#39;ee&#39;)</span>

<span class="sd">        :return: An EllipsePlot object</span>
<span class="sd">        :rtype: EllipsePlot</span>

<span class="sd">        - ``robot.fellipse(q)`` creates a force ellipsoid for the robot at</span>
<span class="sd">          pose ``q``. The ellipsoid is centered at the origin.</span>

<span class="sd">        - ``robot.fellipse()`` as above except the joint configuration is that</span>
<span class="sd">          stored in the robot object.</span>

<span class="sd">        .. note::</span>
<span class="sd">            - By default the ellipsoid related to translational motion is</span>
<span class="sd">              drawn.  Use ``opt=&#39;rot&#39;`` to draw the rotational velocity</span>
<span class="sd">              ellipsoid.</span>
<span class="sd">            - By default the ellipsoid is drawn at the origin.  The option</span>
<span class="sd">              ``centre`` allows its origin to set to set to the specified</span>
<span class="sd">              3-vector, or the string &quot;ee&quot; ensures it is drawn at the</span>
<span class="sd">              end-effector position.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">ERobot</span><span class="p">):</span>  <span class="c1"># pragma nocover</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;ERobot fellipse not implemented yet&quot;</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">getunit</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="n">ell</span> <span class="o">=</span> <span class="n">EllipsePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">centre</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ell</span></div>

<div class="viewcode-block" id="Robot.vellipse"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.vellipse">[docs]</a>    <span class="k">def</span> <span class="nf">vellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s2">&quot;trans&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a velocity ellipsoid object for plotting with PyPlot</span>

<span class="sd">        :param q: The joint configuration of the robot (Optional,</span>
<span class="sd">            if not supplied will use the stored q values).</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param opt: &#39;trans&#39; or &#39;rot&#39; will plot either the translational or</span>
<span class="sd">            rotational velocity ellipsoid</span>
<span class="sd">        :type opt: string</span>
<span class="sd">        :param centre:</span>
<span class="sd">        :type centre: list or str(&#39;ee&#39;)</span>

<span class="sd">        :return: An EllipsePlot object</span>
<span class="sd">        :rtype: EllipsePlot</span>

<span class="sd">        - ``robot.vellipse(q)`` creates a force ellipsoid for the robot at</span>
<span class="sd">          pose ``q``. The ellipsoid is centered at the origin.</span>

<span class="sd">        - ``robot.vellipse()`` as above except the joint configuration is that</span>
<span class="sd">          stored in the robot object.</span>

<span class="sd">        .. note::</span>
<span class="sd">            - By default the ellipsoid related to translational motion is</span>
<span class="sd">              drawn.  Use ``opt=&#39;rot&#39;`` to draw the rotational velocity</span>
<span class="sd">              ellipsoid.</span>
<span class="sd">            - By default the ellipsoid is drawn at the origin.  The option</span>
<span class="sd">              ``centre`` allows its origin to set to set to the specified</span>
<span class="sd">              3-vector, or the string &quot;ee&quot; ensures it is drawn at the</span>
<span class="sd">              end-effector position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">ERobot</span><span class="p">):</span>  <span class="c1"># pragma nocover</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;ERobot vellipse not implemented yet&quot;</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">getunit</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="n">ell</span> <span class="o">=</span> <span class="n">EllipsePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">centre</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ell</span></div>

<div class="viewcode-block" id="Robot.plot_ellipse"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.plot_ellipse">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ellipse</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ellipse</span><span class="p">,</span>
        <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">jointaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">eeframe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the an ellipsoid</span>

<span class="sd">        :param block: Block operation of the code and keep the figure open</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        :param ellipse: the ellipsoid to plot</span>
<span class="sd">        :type ellipse: EllipsePlot</span>
<span class="sd">        :param jointaxes: (Plot Option) Plot an arrow indicating the axes in</span>
<span class="sd">            which the joint revolves around(revolute joint) or translates</span>
<span class="sd">            along (prosmatic joint)</span>
<span class="sd">        :type jointaxes: bool</span>
<span class="sd">        :param eeframe: (Plot Option) Plot the end-effector coordinate frame</span>
<span class="sd">            at the location of the end-effector. Uses three arrows, red,</span>
<span class="sd">            green and blue to indicate the x, y, and z-axes.</span>
<span class="sd">        :type eeframe: bool</span>
<span class="sd">        :param shadow: (Plot Option) Plot a shadow of the robot in the x-y</span>
<span class="sd">            plane</span>
<span class="sd">        :type shadow: bool</span>
<span class="sd">        :param name: (Plot Option) Plot the name of the robot near its base</span>
<span class="sd">        :type name: bool</span>

<span class="sd">        :return: A reference to the PyPlot object which controls the</span>
<span class="sd">            matplotlib figure</span>
<span class="sd">        :rtype: PyPlot</span>

<span class="sd">        - ``robot.plot_ellipse(ellipsoid)`` displays the ellipsoid.</span>

<span class="sd">        .. note::</span>
<span class="sd">            - By default the ellipsoid is drawn at the origin.  The option</span>
<span class="sd">              ``centre`` allows its origin to set to set to the specified</span>
<span class="sd">              3-vector, or the string &quot;ee&quot; ensures it is drawn at the</span>
<span class="sd">              end-effector position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">EllipsePlot</span><span class="p">):</span>  <span class="c1"># pragma nocover</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;ellipse must be of type &quot;</span> <span class="s2">&quot;roboticstoolbox.backend.PyPlot.EllipsePlot&quot;</span>
            <span class="p">)</span>

        <span class="n">env</span> <span class="o">=</span> <span class="n">PyPlot</span><span class="p">()</span>

        <span class="c1"># Add the robot to the figure in readonly mode</span>
        <span class="n">env</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">ellipse</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">ellipse</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>

        <span class="n">env</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">jointaxes</span><span class="o">=</span><span class="n">jointaxes</span><span class="p">,</span> <span class="n">eeframe</span><span class="o">=</span><span class="n">eeframe</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="n">shadow</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Keep the plot open</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">env</span><span class="o">.</span><span class="n">hold</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">env</span></div>

<div class="viewcode-block" id="Robot.plot_fellipse"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.plot_fellipse">[docs]</a>    <span class="k">def</span> <span class="nf">plot_fellipse</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">opt</span><span class="o">=</span><span class="s2">&quot;trans&quot;</span><span class="p">,</span>
        <span class="n">centre</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">jointaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">eeframe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the force ellipsoid for manipulator</span>

<span class="sd">        :param block: Block operation of the code and keep the figure open</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        :param q: The joint configuration of the robot (Optional,</span>
<span class="sd">            if not supplied will use the stored q values).</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param fellipse: the vellocity ellipsoid to plot</span>
<span class="sd">        :type fellipse: EllipsePlot</span>
<span class="sd">        :param limits: Custom view limits for the plot. If not supplied will</span>
<span class="sd">            autoscale, [x1, x2, y1, y2, z1, z2]</span>
<span class="sd">        :type limits: ndarray(6)</span>
<span class="sd">        :param opt: &#39;trans&#39; or &#39;rot&#39; will plot either the translational or</span>
<span class="sd">            rotational force ellipsoid</span>
<span class="sd">        :type opt: string</span>
<span class="sd">        :param centre: The coordinates to plot the fellipse [x, y, z] or &quot;ee&quot;</span>
<span class="sd">            to plot at the end-effector location</span>
<span class="sd">        :type centre: array_like or str</span>
<span class="sd">        :param jointaxes: (Plot Option) Plot an arrow indicating the axes in</span>
<span class="sd">            which the joint revolves around(revolute joint) or translates</span>
<span class="sd">            along (prosmatic joint)</span>
<span class="sd">        :type jointaxes: bool</span>
<span class="sd">        :param eeframe: (Plot Option) Plot the end-effector coordinate frame</span>
<span class="sd">            at the location of the end-effector. Uses three arrows, red,</span>
<span class="sd">            green and blue to indicate the x, y, and z-axes.</span>
<span class="sd">        :type eeframe: bool</span>
<span class="sd">        :param shadow: (Plot Option) Plot a shadow of the robot in the x-y</span>
<span class="sd">            plane</span>
<span class="sd">        :type shadow: bool</span>
<span class="sd">        :param name: (Plot Option) Plot the name of the robot near its base</span>
<span class="sd">        :type name: bool</span>

<span class="sd">        :return: A reference to the PyPlot object which controls the</span>
<span class="sd">            matplotlib figure</span>
<span class="sd">        :rtype: PyPlot</span>

<span class="sd">        - ``robot.plot_fellipse(q)`` displays the velocity ellipsoid for the</span>
<span class="sd">          robot at pose ``q``. The plot will autoscale with an aspect ratio</span>
<span class="sd">          of 1.</span>

<span class="sd">        - ``plot_fellipse()`` as above except the robot is plotted with joint</span>
<span class="sd">          coordinates stored in the robot object.</span>

<span class="sd">        - ``robot.plot_fellipse(vellipse)`` specifies a custon ellipse to plot.</span>

<span class="sd">        .. note::</span>
<span class="sd">            - By default the ellipsoid related to translational motion is</span>
<span class="sd">              drawn.  Use ``opt=&#39;rot&#39;`` to draw the rotational velocity</span>
<span class="sd">              ellipsoid.</span>
<span class="sd">            - By default the ellipsoid is drawn at the origin.  The option</span>
<span class="sd">              ``centre`` allows its origin to set to set to the specified</span>
<span class="sd">              3-vector, or the string &quot;ee&quot; ensures it is drawn at the</span>
<span class="sd">              end-effector position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">ERobot</span><span class="p">):</span>  <span class="c1"># pragma nocover</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Ellipse Plotting of ERobot&#39;s not implemented yet&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>

        <span class="k">if</span> <span class="n">fellipse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fellipse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fellipse</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">centre</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_ellipse</span><span class="p">(</span>
            <span class="n">fellipse</span><span class="p">,</span>
            <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
            <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">jointaxes</span><span class="o">=</span><span class="n">jointaxes</span><span class="p">,</span>
            <span class="n">eeframe</span><span class="o">=</span><span class="n">eeframe</span><span class="p">,</span>
            <span class="n">shadow</span><span class="o">=</span><span class="n">shadow</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Robot.plot_vellipse"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.plot_vellipse">[docs]</a>    <span class="k">def</span> <span class="nf">plot_vellipse</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">vellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">opt</span><span class="o">=</span><span class="s2">&quot;trans&quot;</span><span class="p">,</span>
        <span class="n">centre</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">jointaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">eeframe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the velocity ellipsoid for manipulator</span>

<span class="sd">        :param block: Block operation of the code and keep the figure open</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        :param q: The joint configuration of the robot (Optional,</span>
<span class="sd">            if not supplied will use the stored q values).</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param vellipse: the vellocity ellipsoid to plot</span>
<span class="sd">        :type vellipse: EllipsePlot</span>
<span class="sd">        :param limits: Custom view limits for the plot. If not supplied will</span>
<span class="sd">            autoscale, [x1, x2, y1, y2, z1, z2]</span>
<span class="sd">        :type limits: ndarray(6)</span>
<span class="sd">        :param opt: &#39;trans&#39; or &#39;rot&#39; will plot either the translational or</span>
<span class="sd">            rotational velocity ellipsoid</span>
<span class="sd">        :type opt: string</span>
<span class="sd">        :param centre: The coordinates to plot the vellipse [x, y, z] or &quot;ee&quot;</span>
<span class="sd">            to plot at the end-effector location</span>
<span class="sd">        :type centre: array_like or str</span>
<span class="sd">        :param jointaxes: (Plot Option) Plot an arrow indicating the axes in</span>
<span class="sd">            which the joint revolves around(revolute joint) or translates</span>
<span class="sd">            along (prosmatic joint)</span>
<span class="sd">        :type jointaxes: bool</span>
<span class="sd">        :param eeframe: (Plot Option) Plot the end-effector coordinate frame</span>
<span class="sd">            at the location of the end-effector. Uses three arrows, red,</span>
<span class="sd">            green and blue to indicate the x, y, and z-axes.</span>
<span class="sd">        :type eeframe: bool</span>
<span class="sd">        :param shadow: (Plot Option) Plot a shadow of the robot in the x-y</span>
<span class="sd">            plane</span>
<span class="sd">        :type shadow: bool</span>
<span class="sd">        :param name: (Plot Option) Plot the name of the robot near its base</span>
<span class="sd">        :type name: bool</span>

<span class="sd">        :return: A reference to the PyPlot object which controls the</span>
<span class="sd">            matplotlib figure</span>
<span class="sd">        :rtype: PyPlot</span>

<span class="sd">        - ``robot.plot_vellipse(q)`` displays the velocity ellipsoid for the</span>
<span class="sd">          robot at pose ``q``. The plot will autoscale with an aspect ratio</span>
<span class="sd">          of 1.</span>

<span class="sd">        - ``plot_vellipse()`` as above except the robot is plotted with joint</span>
<span class="sd">          coordinates stored in the robot object.</span>

<span class="sd">        - ``robot.plot_vellipse(vellipse)`` specifies a custon ellipse to plot.</span>

<span class="sd">        .. note::</span>
<span class="sd">            - By default the ellipsoid related to translational motion is</span>
<span class="sd">              drawn.  Use ``opt=&#39;rot&#39;`` to draw the rotational velocity</span>
<span class="sd">              ellipsoid.</span>
<span class="sd">            - By default the ellipsoid is drawn at the origin.  The option</span>
<span class="sd">              ``centre`` allows its origin to set to set to the specified</span>
<span class="sd">              3-vector, or the string &quot;ee&quot; ensures it is drawn at the</span>
<span class="sd">              end-effector position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">ERobot</span><span class="p">):</span>  <span class="c1"># pragma nocover</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Ellipse Plotting of ERobot&#39;s not implemented yet&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>

        <span class="k">if</span> <span class="n">vellipse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vellipse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vellipse</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">centre</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_ellipse</span><span class="p">(</span>
            <span class="n">vellipse</span><span class="p">,</span>
            <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
            <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span>
            <span class="n">jointaxes</span><span class="o">=</span><span class="n">jointaxes</span><span class="p">,</span>
            <span class="n">eeframe</span><span class="o">=</span><span class="n">eeframe</span><span class="p">,</span>
            <span class="n">shadow</span><span class="o">=</span><span class="n">shadow</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------------- #</span>

<div class="viewcode-block" id="Robot.teach"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.teach">[docs]</a>    <span class="k">def</span> <span class="nf">teach</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span>
        <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">jointaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">jointlabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">vellipse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fellipse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">eeframe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Graphical teach pendant</span>

<span class="sd">        :param block: Block operation of the code and keep the figure open</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        :param q: The joint configuration of the robot (Optional,</span>
<span class="sd">                  if not supplied will use the stored q values).</span>
<span class="sd">        :type q: float ndarray(n)</span>
<span class="sd">        :param limits: Custom view limits for the plot. If not supplied will</span>
<span class="sd">                       autoscale, [x1, x2, y1, y2, z1, z2]</span>
<span class="sd">        :type limits: ndarray(6)</span>
<span class="sd">        :param jointaxes: (Plot Option) Plot an arrow indicating the axes in</span>
<span class="sd">                          which the joint revolves around(revolute joint) or</span>
<span class="sd">                          translates along (prismatic joint)</span>
<span class="sd">        :type jointaxes: bool</span>
<span class="sd">        :param eeframe: (Plot Option) Plot the end-effector coordinate frame</span>
<span class="sd">            at the location of the end-effector. Uses three arrows, red,</span>
<span class="sd">            green and blue to indicate the x, y, and z-axes.</span>
<span class="sd">        :type eeframe: bool</span>
<span class="sd">        :param shadow: (Plot Option) Plot a shadow of the robot in the x-y</span>
<span class="sd">            plane</span>
<span class="sd">        :type shadow: bool</span>
<span class="sd">        :param name: (Plot Option) Plot the name of the robot near its base</span>
<span class="sd">        :type name: bool</span>

<span class="sd">        :return: A reference to the PyPlot object which controls the</span>
<span class="sd">            matplotlib figure</span>
<span class="sd">        :rtype: PyPlot</span>

<span class="sd">        - ``robot.teach(q)`` creates a matplotlib plot which allows the user to</span>
<span class="sd">          &quot;drive&quot; a graphical robot using a graphical slider panel. The robot&#39;s</span>
<span class="sd">          inital joint configuration is ``q``. The plot will autoscale with an</span>
<span class="sd">          aspect ratio of 1.</span>

<span class="sd">        - ``robot.teach()`` as above except the robot&#39;s stored value of ``q``</span>
<span class="sd">            is used.</span>

<span class="sd">        .. note::</span>
<span class="sd">            - Program execution is blocked until the teach window is</span>
<span class="sd">              dismissed.  If ``block=False`` the method is non-blocking but</span>
<span class="sd">              you need to poll the window manager to ensure that the window</span>
<span class="sd">              remains responsive.</span>
<span class="sd">            - The slider limits are derived from the joint limit properties.</span>
<span class="sd">              If not set then:</span>
<span class="sd">                - For revolute joints they are assumed to be [-pi, +pi]</span>
<span class="sd">                - For prismatic joint they are assumed unknown and an error</span>
<span class="sd">                  occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">getvector</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="c1"># Make an empty 3D figure</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_graphical_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

        <span class="c1"># Add the self to the figure in readonly mode</span>
        <span class="n">env</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="s2">&quot;Teach &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="c1"># jointaxes=jointaxes,</span>
            <span class="c1"># jointlabels=jointlabels,</span>
            <span class="c1"># eeframe=eeframe,</span>
            <span class="c1"># shadow=shadow,</span>
            <span class="c1"># name=name,</span>
        <span class="p">)</span>

        <span class="n">env</span><span class="o">.</span><span class="n">_add_teach_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vellipse</span><span class="p">:</span>
            <span class="n">vell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vellipse</span><span class="p">(</span><span class="n">centre</span><span class="o">=</span><span class="s2">&quot;ee&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">env</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vell</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fellipse</span><span class="p">:</span>
            <span class="n">fell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fellipse</span><span class="p">(</span><span class="n">centre</span><span class="o">=</span><span class="s2">&quot;ee&quot;</span><span class="p">)</span>
            <span class="n">env</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fell</span><span class="p">)</span>

        <span class="c1"># Keep the plot open</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">env</span><span class="o">.</span><span class="n">hold</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">env</span></div>

    <span class="c1"># --------------------------------------------------------------------- #</span>

<div class="viewcode-block" id="Robot.closest_point"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.closest_point">[docs]</a>    <span class="k">def</span> <span class="nf">closest_point</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span><span class="p">,</span> <span class="n">inf_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">skip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        closest_point(shape, inf_dist) returns the minimum euclidean</span>
<span class="sd">        distance between this robot and shape, provided it is less than</span>
<span class="sd">        inf_dist. It will also return the points on self and shape in the</span>
<span class="sd">        world frame which connect the line of length distance between the</span>
<span class="sd">        shapes. If the distance is negative then the shapes are collided.</span>

<span class="sd">        :param shape: The shape to compare distance to</span>
<span class="sd">        :param inf_dist: The minimum distance within which to consider</span>
<span class="sd">            the shape</span>
<span class="sd">        :param skip: Skip setting all shape transforms based on q, use this</span>
<span class="sd">            option if using this method in conjuction with Swift to save time</span>

<span class="sd">        :returns: d, p1, p2 where d is the distance between the shapes,</span>
<span class="sd">            p1 and p2 are the points in the world frame on the respective</span>
<span class="sd">            shapes. The points returned are [x, y, z].</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_link_tf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_propogate_scene_tree</span><span class="p">()</span>
            <span class="n">shape</span><span class="o">.</span><span class="n">_propogate_scene_tree</span><span class="p">()</span>

        <span class="n">d</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="n">td</span><span class="p">,</span> <span class="n">tp1</span><span class="p">,</span> <span class="n">tp2</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">closest_point</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">inf_dist</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">td</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">td</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">td</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">tp1</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">tp2</span>

        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">10000</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span></div>

<div class="viewcode-block" id="Robot.iscollided"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.iscollided">[docs]</a>    <span class="k">def</span> <span class="nf">iscollided</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        collided(shape) checks if this robot and shape have collided</span>
<span class="sd">        :param shape: The shape to compare distance to</span>
<span class="sd">        :type shape: Shape</span>
<span class="sd">        :param skip: Skip setting all shape transforms based on q, use this</span>
<span class="sd">            option if using this method in conjuction with Swift to save time</span>
<span class="sd">        :type skip: boolean</span>
<span class="sd">        :returns: True if shapes have collided</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_link_tf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_propogate_scene_tree</span><span class="p">()</span>
            <span class="n">shape</span><span class="o">.</span><span class="n">_propogate_scene_tree</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">iscollided</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtb</span><span class="o">.</span><span class="n">ERobot</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">gripper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grippers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">gripper</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">iscollided</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Robot.collided"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.collided">[docs]</a>    <span class="k">def</span> <span class="nf">collided</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        collided(shape) checks if this robot and shape have collided</span>
<span class="sd">        :param shape: The shape to compare distance to</span>
<span class="sd">        :type shape: Shape</span>
<span class="sd">        :param skip: Skip setting all shape transforms based on q, use this</span>
<span class="sd">            option if using this method in conjuction with Swift to save time</span>
<span class="sd">        :type skip: boolean</span>
<span class="sd">        :returns: True if shapes have collided</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;method collided is deprecated, use iscollided instead&quot;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscollided</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">)</span></div>

<div class="viewcode-block" id="Robot.joint_velocity_damper"><a class="viewcode-back" href="../../../arm_superclass.html#roboticstoolbox.robot.Robot.Robot.joint_velocity_damper">[docs]</a>    <span class="k">def</span> <span class="nf">joint_velocity_damper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ps</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">pi</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formulates an inequality contraint which, when optimised for will</span>
<span class="sd">        make it impossible for the robot to run into joint limits. Requires</span>
<span class="sd">        the joint limits of the robot to be specified. See examples/mmc.py</span>
<span class="sd">        for use case</span>

<span class="sd">        :param ps: The minimum angle (in radians) in which the joint is</span>
<span class="sd">            allowed to approach to its limit</span>
<span class="sd">        :type ps: float</span>
<span class="sd">        :param pi: The influence angle (in radians) in which the velocity</span>
<span class="sd">            damper becomes active</span>
<span class="sd">        :type pi: float</span>
<span class="sd">        :param n: The number of joints to consider. Defaults to all joints</span>
<span class="sd">        :type n: int</span>
<span class="sd">        :param gain: The gain for the velocity damper</span>
<span class="sd">        :type gain: float</span>

<span class="sd">        :returns: Ain, Bin as the inequality contraints for an optisator</span>
<span class="sd">        :rtype: ndarray(6), ndarray(6)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>

        <span class="n">Ain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">Bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">qlim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pi</span><span class="p">:</span>
                <span class="n">Bin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">gain</span> <span class="o">*</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">qlim</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">ps</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pi</span> <span class="o">-</span> <span class="n">ps</span><span class="p">))</span>
                <span class="n">Ain</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qlim</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pi</span><span class="p">:</span>
                <span class="n">Bin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">qlim</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">ps</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pi</span> <span class="o">-</span> <span class="n">ps</span><span class="p">)</span>
                <span class="n">Ain</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">Ain</span><span class="p">,</span> <span class="n">Bin</span></div>

    <span class="c1"># --------------------------------------------------------------------- #</span>
    <span class="c1"># Scene Graph section</span>
    <span class="c1"># --------------------------------------------------------------------- #</span>

    <span class="k">def</span> <span class="nf">_update_link_tf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This private method updates the local transform of each link within</span>
<span class="sd">        this robot according to q (or self.q if q is none)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">get_link_ets</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">ets</span><span class="o">.</span><span class="n">_fknm</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">]</span>

        <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">get_link_scene_node</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">_T_reference</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">]</span>

        <span class="n">Robot_link_T</span><span class="p">(</span><span class="n">get_link_ets</span><span class="p">(),</span> <span class="n">get_link_scene_node</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

        <span class="p">[</span><span class="n">gripper</span><span class="o">.</span><span class="n">_update_link_tf</span><span class="p">()</span> <span class="k">for</span> <span class="n">gripper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grippers</span><span class="p">]</span></div>

    <span class="c1"># --------------------------------------------------------------------- #</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="k">pass</span>

    <span class="c1"># import roboticstoolbox as rtb</span>

    <span class="c1"># puma = rtb.models.DH.Puma560()</span>
    <span class="c1"># a = puma.copy()</span>

    <span class="c1"># from roboticstoolbox import ET2 as ET</span>

    <span class="c1"># e = ET.R() * ET.tx(1) * ET.R() * ET.tx(1)</span>
    <span class="c1"># print(e)</span>
    <span class="c1"># r = Robot2(e)</span>

    <span class="c1"># print(r.fkine([0, 0]))</span>
    <span class="c1"># print(r.jacob0([0, 0]))</span>

    <span class="c1"># r.plot([0.7, 0.7])</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Jesse Haviland and Peter Corke.
      <span class="lastupdated">Last updated on 25-Jan-2023.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-11Q6WJM565"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-11Q6WJM565', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>